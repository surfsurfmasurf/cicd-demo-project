<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Brownian SDF Object - CI/CD Demo</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #0f172a; 
            color: #e2e8f0; 
            font-family: 'Pretendard', -apple-system, sans-serif;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh; 
        }
        #canvas-container { 
            margin-top: 40px; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3); 
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #334155;
            width: 600px;
            height: 600px;
            background: #000;
        }
        .content { 
            max-width: 900px; 
            width: 90%; 
            margin: 40px 0; 
            padding: 30px; 
            background: #1e293b; 
            border-radius: 16px; 
            border: 1px solid #334155;
        }
        h1 { color: #38bdf8; margin-bottom: 10px; font-size: 2rem; }
        h2 { color: #94a3b8; font-size: 1.2rem; margin-top: 30px; margin-bottom: 15px; border-bottom: 1px solid #334155; padding-bottom: 10px; }
        p { line-height: 1.7; color: #cbd5e1; margin-bottom: 15px; }
        .code-block { 
            background: #0f172a; 
            padding: 20px; 
            border-radius: 8px; 
            overflow-x: auto; 
            border: 1px solid #334155;
            position: relative;
        }
        pre { 
            margin: 0;
            font-family: 'Consolas', monospace; 
            font-size: 14px; 
            color: #a5b4fc;
            line-height: 1.5;
        }
        .back-link { 
            margin: 30px 0 60px; 
            color: #64748b; 
            text-decoration: none; 
            font-weight: 600;
        }
        .back-link:hover { color: #38bdf8; }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div class="content">
        <h1>Brownian Motion on SDF</h1>
        <p>
            ì´ ì‘í’ˆì€ <strong>ìˆ˜í•™ì  ê±°ë¦¬ í•¨ìˆ˜(SDF)</strong>ë¥¼ ì´ìš©í•´ ë§Œë“  3D ê°ì²´ ìœ„ì—ì„œ 
            <strong>ë¸Œë¼ìš´ ìš´ë™(Brownian Motion)</strong>ì²˜ëŸ¼ ë¶ˆê·œì¹™í•˜ê²Œ ì›€ì§ì´ëŠ” ë¹›ì˜ íë¦„ì„ í‘œí˜„í•©ë‹ˆë‹¤.
        </p>

        <h2>ğŸ¨ ì‘í’ˆ í•´ì„¤ (ì´ˆë“±í•™ìƒë„ ì´í•´í•˜ê¸° ì‰½ê²Œ!)</h2>
        <p>
            <strong>1. ì‘ì€ ìƒìë“¤ë¡œ ë§Œë“  í° ê³µ (SDF Object)</strong><br>
            ì½”ë“œë¥¼ ë³´ë©´ <code>round(p/.5)</code>ë¼ëŠ” ë¶€ë¶„ì´ ìˆì–´ìš”. ì´ê±´ ê³µê°„ì„ 0.5 ê°„ê²©ìœ¼ë¡œ ì˜ë¼ì„œ **ë¬´ìˆ˜íˆ ë§ì€ ì‘ì€ ë°©**ì„ ë§Œë“œëŠ” ê±°ì˜ˆìš”.
            ê° ë°©ë§ˆë‹¤ **ì‘ì€ ìƒì(Cube)**ë¥¼ í•˜ë‚˜ì”© ë„£ê³ , ë§ˆì§€ë§‰ì— **í° ê³µ(Sphere)** ëª¨ì–‘ ì•ˆìœ¼ë¡œë§Œ ë³´ì´ê²Œ ì˜ë¼ëƒˆì–´ìš”.
            ê·¸ë˜ì„œ ë§ˆì¹˜ **ë ˆê³  ë¸”ë¡ìœ¼ë¡œ ë§Œë“  ê³µ**ì²˜ëŸ¼ ë³´ì´ëŠ” ê±°ì£ ! ğŸ§Šâš½
        </p>
        <p>
            <strong>2. ì¶¤ì¶”ëŠ” ë¹› (Brownian Motion)</strong><br>
            **ë¸Œë¼ìš´ ìš´ë™**ì€ ë¬¼ ìœ„ì— ë–  ìˆëŠ” ê½ƒê°€ë£¨ê°€ ë¬¼ ë¶„ìì™€ ë¶€ë”ªí˜€ì„œ ì´ë¦¬ì €ë¦¬ íŠ€ëŠ” í˜„ìƒì„ ë§í•´ìš”.
            ì—¬ê¸°ì„œëŠ” ë¹›ì´ ì´ ë³µì¡í•œ ìƒìë“¤ ì‚¬ì´ë¥¼ í†µê³¼í•˜ë©´ì„œ **ë¬´ì‘ìœ„ë¡œ êµ´ì ˆë˜ê³  ë°˜ì‚¬ë˜ëŠ” ëª¨ìŠµ**ì„ í‘œí˜„í–ˆì–´ìš”.
            ë§ˆì¹˜ ë¯¸ë¡œ ì†ì„ í—¤ë§¤ëŠ” ë°˜ë”§ë¶ˆì´ì²˜ëŸ¼ìš”! âœ¨
        </p>

        <h2>ğŸ’» Shader Source Code</h2>
        <div class="code-block">
            <pre id="shader-code"></pre>
        </div>
    </div>

    <a href="/" class="back-link">â† ê°¤ëŸ¬ë¦¬ë¡œ ëŒì•„ê°€ê¸°</a>

    <script>
        let theShader;

        // Vertex Shader
        const vertSrc = `
            attribute vec3 aPosition;
            attribute vec2 aTexCoord;
            varying vec2 vTexCoord;
            void main() {
                vTexCoord = aTexCoord;
                vec4 positionVec4 = vec4(aPosition, 1.0);
                gl_Position = positionVec4;
            }
        `;

        // Fragment Shader (SDF Raymarching Implementation)
        const fragSrc = `
            #ifdef GL_ES
            precision highp float;
            #endif

            uniform vec2 u_resolution;
            uniform float u_time;

            // Rotation Matrix
            mat2 rot(float a) {
                float s = sin(a);
                float c = cos(a);
                return mat2(c, -s, s, c);
            }

            // Scene Distance Function
            float map(vec3 p) {
                // Apply rotation over time
                p.yz *= rot(u_time * 0.2);
                p.xz *= rot(u_time * 0.3);

                // 1. Box Grid (Modulation)
                // vec3 t = p - 0.5 * round(p / 0.5); (GLSL 1.0 workaround for round)
                vec3 t = p - 0.5 * floor(p / 0.5 + 0.5);
                
                // 2. Box SDF
                vec3 r = abs(t) - vec3(0.12); // Slightly larger boxes
                float box = length(max(r, 0.0)) + min(max(r.x, max(r.y, r.z)), 0.0);
                
                // 3. Sphere Intersection
                float sphere = length(p) - 1.9;
                
                // Combine: Boxes restricted inside the sphere
                return max(box, sphere);
            }

            void main() {
                vec2 uv = (gl_FragCoord.xy - 0.5 * u_resolution.xy) / u_resolution.y;
                vec3 col = vec3(0.0);

                // Ray setup
                vec3 ro = vec3(0.0, 0.0, -4.0);
                vec3 rd = normalize(vec3(uv, 1.0));

                // Raymarching Loop
                float t = 0.0;
                float d = 0.0;
                int steps = 0;
                
                for(int i = 0; i < 64; i++) {
                    vec3 p = ro + rd * t;
                    d = map(p);
                    if(d < 0.001 || t > 10.0) break;
                    t += d;
                    steps = i;
                }

                // Coloring based on iteration count (Glow Effect)
                if(t < 10.0) {
                    float glow = float(steps) / 64.0;
                    // Blue-Purple Glow
                    col = vec3(0.2, 0.6, 1.0) * glow * 2.5;
                    col += vec3(1.0, 0.3, 0.8) * glow * glow;
                } 
                else {
                    // Dark Background
                    col = vec3(0.02, 0.02, 0.05);
                }

                gl_FragColor = vec4(col, 1.0);
            }
        `;

        function setup() {
            let c = createCanvas(600, 600, WEBGL);
            c.parent('canvas-container');
            noStroke();
            theShader = createShader(vertSrc, fragSrc);
            document.getElementById('shader-code').textContent = fragSrc;
        }

        function draw() {
            shader(theShader);
            theShader.setUniform('u_resolution', [width, height]);
            theShader.setUniform('u_time', millis() / 1000.0);
            
            // Draw a full-screen quad in clip space (-1 to 1)
            beginShape();
            vertex(-1, -1);
            vertex(1, -1);
            vertex(1, 1);
            vertex(-1, 1);
            endShape(CLOSE);
        }
    </script>
</body>
</html>
