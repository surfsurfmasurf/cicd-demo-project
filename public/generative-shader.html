<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Generative Shader - p5.js WebGL</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/p5.js/1.7.0/p5.min.js"></script>
    <style>
        body { 
            margin: 0; 
            padding: 0; 
            background: #0f172a; 
            color: #e2e8f0; 
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif;
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            min-height: 100vh; 
        }
        #canvas-container { 
            margin-top: 40px; 
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.3), 0 10px 10px -5px rgba(0, 0, 0, 0.2); 
            border-radius: 12px;
            overflow: hidden;
            border: 1px solid #334155;
            /* Canvas size is 400px */
            width: 400px;
            height: 400px;
        }
        .content { 
            max-width: 900px; 
            width: 90%; 
            margin: 40px 0; 
            padding: 30px; 
            background: #1e293b; 
            border-radius: 16px; 
            border: 1px solid #334155;
        }
        h1 { 
            color: #38bdf8; 
            margin-bottom: 10px;
            font-size: 2rem;
        }
        h2 {
            color: #94a3b8;
            font-size: 1.2rem;
            margin-top: 30px;
            margin-bottom: 15px;
            border-bottom: 1px solid #334155;
            padding-bottom: 10px;
        }
        p {
            line-height: 1.7;
            color: #cbd5e1;
            margin-bottom: 15px;
        }
        .code-block { 
            background: #0f172a; 
            padding: 20px; 
            border-radius: 8px; 
            overflow-x: auto; 
            border: 1px solid #334155;
            position: relative;
        }
        pre { 
            margin: 0;
            font-family: 'Consolas', monospace; 
            font-size: 14px; 
            color: #a5b4fc;
            line-height: 1.5;
        }
        .back-link { 
            margin: 30px 0 60px; 
            color: #64748b; 
            text-decoration: none; 
            transition: color 0.3s; 
            font-weight: 600;
        }
        .back-link:hover { color: #38bdf8; }
    </style>
</head>
<body>
    <div id="canvas-container"></div>
    
    <div class="content">
        <h1>Generative Shader</h1>
        <p>ìš”ì²­í•˜ì‹  GLSL ì½”ë“œë¥¼ <strong>p5.js WebGL Shader</strong>ë¡œ ë³€í™˜í•˜ì—¬ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤.</p>
        
        <h2>ğŸ¨ ì‘í’ˆ í•´ì„¤</h2>
        <p>
            ì´ ì½”ë“œëŠ” <strong>Raymarching(ê´‘ì„  íˆ¬ì‚¬)</strong> ê¸°ë²•ì„ ì‚¬ìš©í•˜ëŠ” ì‰ì´ë” ì•„íŠ¸ì…ë‹ˆë‹¤.
            ìˆ˜í•™ì  ê±°ë¦¬ í•¨ìˆ˜(SDF)ì™€ ì‚¼ê°í•¨ìˆ˜ì˜ ë°˜ë³µ ê³„ì‚°ì„ í†µí•´ 3ì°¨ì› ê³µê°„ì˜ ë³µì¡í•œ êµ¬ì¡°ë¥¼ ë Œë”ë§í•©ë‹ˆë‹¤.
            ë‹¨ìˆœí•œ JavaScript ë£¨í”„(`draw()` ë‚´ ì‹¤í–‰)ë¡œëŠ” ìˆ˜ë°±ë§Œ ë²ˆì˜ ì—°ì‚°ì´ í•„ìš”í•˜ì—¬ ë§¤ìš° ëŠë¦¬ê¸° ë•Œë¬¸ì—, 
            GPUë¥¼ í™œìš©í•˜ëŠ” <strong>Fragment Shader</strong>ë¡œ êµ¬í˜„í•´ì•¼ ì‹¤ì‹œê°„ ë Œë”ë§ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤.
        </p>

        <h2>ğŸ’» Shader Source Code</h2>
        <div class="code-block">
            <pre id="shader-code"></pre>
        </div>
    </div>

    <a href="/" class="back-link">â† ê°¤ëŸ¬ë¦¬ë¡œ ëŒì•„ê°€ê¸°</a>

    <script>
        let theShader;

        // Vertex Shader: ê¸°ë³¸ íŒ¨ìŠ¤ìŠ¤ë£¨
        const vertSrc = `
            attribute vec3 aPosition;
            attribute vec2 aTexCoord;
            varying vec2 vTexCoord;
            void main() {
                vTexCoord = aTexCoord;
                vec4 positionVec4 = vec4(aPosition, 1.0);
                positionVec4.xy = positionVec4.xy * 2.0 - 1.0;
                gl_Position = positionVec4;
            }
        `;

        // Fragment Shader: ìš”ì²­í•˜ì‹  GLSL ì½”ë“œ ë³€í™˜
        const fragSrc = `
            #ifdef GL_ES
            precision highp float;
            #endif

            uniform vec2 u_resolution;
            uniform float u_time;

            void main() {
                // p5.js í•´ìƒë„ (width, height)
                vec2 r = u_resolution;
                float t = u_time;
                
                // gl_FragCoord: í˜„ì¬ í”½ì…€ ìœ„ì¹˜ (x, y, z, 1/w)
                vec4 FC = gl_FragCoord; 
                vec4 o = vec4(0.0);

                // ì´ˆê¸° ë³€ìˆ˜ ì„¤ì •
                float z = 0.0; // ê±°ë¦¬ ëˆ„ì ê°’ (Distance from camera)
                float d = 0.0; // í˜„ì¬ ìŠ¤í…ì˜ ê±°ë¦¬ (SDF)
                float i = 0.0; // ë°˜ë³µ ì¹´ìš´í„°

                // Raymarching Loop (50íšŒ ë°˜ë³µ)
                for (float j = 0.0; j < 50.0; j++) {
                    i = j;

                    // Ray Direction ê³„ì‚° (Golf Code: vec3 p=z*normalize(FC.rgb*2.-r.xyx))
                    // FC.rgb -> (x, y, z). r.xyx -> (w, h, w).
                    // í™”ë©´ ì¤‘ì•™ì„ (0,0)ìœ¼ë¡œ ë§ì¶”ê³  ì •ê·œí™”
                    vec3 p = z * normalize(vec3(FC.xy, FC.z) * 2.0 - vec3(r.x, r.y, r.x));

                    // ë‚´ë¶€ ë£¨í”„: í”„ë™íƒˆ/ë…¸ì´ì¦ˆ êµ¬ì¡° ìƒì„± (Golf Code: for(d=0.;d++<9.;)...)
                    for (float k = 0.0; k < 9.0; k++) {
                        float dd = k + 1.0; 
                        // ì‚¼ê°í•¨ìˆ˜ì™€ íšŒì „ì„ ì´ìš©í•´ ì¢Œí‘œ ë¹„í‹€ê¸°
                        p += 0.4 * sin(p.yzx * dd - z + t + i) / dd + 0.5;
                    }
                    
                    // ê±°ë¦¬ í•¨ìˆ˜ (SDF) ê³„ì‚°
                    // Golf Code: d=length(vec4(abs(p.y+p.z*.5),sin(p-z)/7.))/(4.+z*z/1e2);
                    vec3 sinPart = sin(p - z) / 7.0;
                    float absPart = abs(p.y + p.z * 0.5);
                    d = length(vec4(absPart, sinPart)) / (4.0 + z * z / 100.0);
                    
                    // Ray ì „ì§„
                    z += d;
                    
                    // ìƒ‰ìƒ ëˆ„ì  (Volumetric Accumulation)
                    // Golf Code: o+=(.9+sin(i*.1-vec4(6,1,2,0)))/d/d/z+d*z/vec4(4,2,1,0)
                    vec4 colorShift = vec4(6.0, 1.0, 2.0, 0.0);
                    vec4 baseColor = 0.9 + sin(i * 0.1 - colorShift);
                    
                    // ë¹›ì˜ ê°ì‡ (Attenuation) ê³„ì‚°
                    // 0ìœ¼ë¡œ ë‚˜ëˆ„ëŠ” ê²ƒì„ ë°©ì§€í•˜ê¸° ìœ„í•´ ì•„ì£¼ ì‘ì€ ê°’(1e-5) ì‚¬ìš© ê°€ëŠ¥í•˜ì§€ë§Œ, ì›ë³¸ ëŠë‚Œ ìœ ì§€ë¥¼ ìœ„í•´ ê·¸ëŒ€ë¡œ ë‘ 
                    // (WebGLì—ì„œëŠ” 0ìœ¼ë¡œ ë‚˜ëˆ„ë©´ ë³´í†µ ë¬´í•œëŒ€ë‚˜ í° ê°’ì´ ë˜ì–´ í°ìƒ‰/ë°ì€ìƒ‰ì´ ë¨)
                    vec4 term1 = baseColor / (d * d * z);
                    
                    // ë°°ê²½/ê±°ë¦¬ê° ì¶”ê°€
                    vec4 divVec = vec4(4.0, 2.0, 1.0, 0.001); // Alpha 0 ë°©ì§€
                    vec4 term2 = (d * z) / divVec;
                    
                    o += term1 + term2;
                }
                
                // í†¤ ë§¤í•‘ (Tanh ëŒ€ì²´ êµ¬í˜„)
                // Golf Code: o=tanh(o/2e3)
                // GLSL 1.0ì—ëŠ” tanhê°€ ì—†ìœ¼ë¯€ë¡œ ìˆ˜ì‹ìœ¼ë¡œ êµ¬í˜„: (e^2x - 1) / (e^2x + 1)
                vec4 x = o / 2000.0;
                vec4 e2x = exp(2.0 * x);
                o = (e2x - 1.0) / (e2x + 1.0);
                
                // ì•ŒíŒŒê°’ 1.0ìœ¼ë¡œ ê³ ì • (í™”ë©´ í‘œì‹œìš©)
                o.a = 1.0;
                
                gl_FragColor = o;
            }
        `;

        function setup() {
            // WEBGL ëª¨ë“œë¡œ ìº”ë²„ìŠ¤ ìƒì„±
            let c = createCanvas(400, 400, WEBGL);
            c.parent('canvas-container');
            noStroke();
            
            // ì‰ì´ë” ìƒì„±
            theShader = createShader(vertSrc, fragSrc);
            
            // ì½”ë“œ ë¸”ë¡ì— ì†ŒìŠ¤ í‘œì‹œ
            document.getElementById('shader-code').textContent = fragSrc;
        }

        function draw() {
            // ì‰ì´ë” í™œì„±í™”
            shader(theShader);
            
            // ìœ ë‹ˆí¼ ë³€ìˆ˜ ì „ë‹¬
            theShader.setUniform('u_resolution', [width, height]);
            theShader.setUniform('u_time', millis() / 1000.0);
            
            // í™”ë©´ ì „ì²´ë¥¼ ë®ëŠ” ì‚¬ê°í˜• ê·¸ë¦¬ê¸° (ì‰ì´ë” ì‹¤í–‰ íŠ¸ë¦¬ê±°)
            rect(0, 0, width, height);
        }
    </script>
</body>
</html>
